"use client";

import React from 'react';
import { Badge } from '../atoms/Badge';

type CardColorScheme = {
    bg: string;
    textDark: string;
    textMid: string;
    progressBg: string;
    progressFill: string;
    iconStroke: string;
    badgeVariant: 'critique' | 'vigilance' | 'standard';
    icon: React.ReactNode;
};

const colorSchemes: Record<string, CardColorScheme> = {
    critique: {
        bg: '#F8D7DA',
        textDark: '#5C2B2B',
        textMid: '#7A3E3E',
        progressBg: 'rgba(255,255,255,0.4)',
        progressFill: '#D32F2F',
        iconStroke: '#D35D6E',
        badgeVariant: 'critique',
        icon: (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#D35D6E" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
            </svg>
        ),
    },
    vigilance: {
        bg: '#FFEAC2',
        textDark: '#5D4037',
        textMid: '#8D6E63',
        progressBg: 'rgba(255,255,255,0.4)',
        progressFill: '#F9A825',
        iconStroke: '#D98E04',
        badgeVariant: 'vigilance',
        icon: (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#D98E04" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" />
                <path d="M23 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" />
            </svg>
        ),
    },
    standard: {
        bg: '#C8E6C9',
        textDark: '#1B5E20',
        textMid: '#388E3C',
        progressBg: 'rgba(255,255,255,0.4)',
        progressFill: '#2E7D32',
        iconStroke: '#388E3C',
        badgeVariant: 'standard',
        icon: (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#388E3C" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
            </svg>
        ),
    },
    // Variant from Design 1 — blue/indigo card
    'vigilance-blue': {
        bg: '#C5D1F7',
        textDark: '#1A1A1A',
        textMid: 'rgba(26,26,26,0.8)',
        progressBg: 'rgba(255,255,255,0.3)',
        progressFill: '#5C6BC0',
        iconStroke: '#1A1A1A',
        badgeVariant: 'vigilance',
        icon: (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#1A1A1A" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" />
                <path d="M23 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" />
            </svg>
        ),
    },
    // Variant from Design 1 — salmon/coral card
    'critique-salmon': {
        bg: '#F2C4B3',
        textDark: '#1A1A1A',
        textMid: 'rgba(26,26,26,0.8)',
        progressBg: 'rgba(255,255,255,0.3)',
        progressFill: '#D35D6E',
        iconStroke: '#1A1A1A',
        badgeVariant: 'critique',
        icon: (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#1A1A1A" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
            </svg>
        ),
    },
    // Variant — soft mint green
    'standard-mint': {
        bg: '#D1E8D8',
        textDark: '#1A1A1A',
        textMid: 'rgba(26,26,26,0.8)',
        progressBg: 'rgba(255,255,255,0.3)',
        progressFill: '#34C88A',
        iconStroke: '#1A1A1A',
        badgeVariant: 'standard',
        icon: (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#1A1A1A" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
            </svg>
        ),
    },
};

interface VulnerabilityCardProps {
    title: string;
    description: string;
    score: number;
    scheme: keyof typeof colorSchemes;
    variant?: 'design1' | 'design2';
    onClick?: () => void;
}

export const VulnerabilityCard = ({
    title,
    description,
    score,
    scheme,
    variant = 'design2',
    onClick,
}: VulnerabilityCardProps) => {
    const s = colorSchemes[scheme] || colorSchemes.standard;

    if (variant === 'design1') {
        // Design 1 — large card with blobs, big score, arrow button
        return (
            <div
                onClick={onClick}
                className="rounded-[32px] p-7 relative overflow-hidden group hover:shadow-lg transition-all duration-300 cursor-pointer"
                style={{ backgroundColor: s.bg }}
            >
                {/* Decorative blobs */}
                <div className="blob w-32 h-32 bg-white opacity-20 -right-8 -top-8" />
                <div className="blob w-24 h-24 opacity-10 bottom-0 left-10" style={{ backgroundColor: s.progressFill }} />

                <div className="relative z-10">
                    <div className="flex justify-between items-start mb-4">
                        <Badge variant={s.badgeVariant} />
                        <div className="bg-white/30 p-2.5 rounded-full backdrop-blur-sm">
                            {s.icon}
                        </div>
                    </div>

                    <h3 className="text-2xl font-bold mb-2" style={{ color: s.textDark }}>{title}</h3>
                    <p className="text-[15px] font-medium mb-6 leading-relaxed w-5/6" style={{ color: s.textMid }}>
                        {description}
                    </p>

                    <div className="flex items-center justify-between mt-auto">
                        <div className="flex flex-col">
                            <span className="text-[10px] uppercase font-bold tracking-wide mb-0.5" style={{ color: `${s.textDark}80` }}>
                                Score actuel
                            </span>
                            <div className="flex items-baseline gap-1">
                                <span className="text-4xl font-bold" style={{ color: s.textDark }}>{score}</span>
                                <span className="text-sm font-semibold" style={{ color: `${s.textDark}99` }}>/100</span>
                            </div>
                        </div>
                        <button className="w-12 h-12 rounded-full bg-white/30 backdrop-blur-sm flex items-center justify-center hover:bg-white/50 transition-colors shadow-sm">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke={s.textDark} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                <line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        );
    }

    // Design 2 — compact card with icon, progress bar, score inline
    return (
        <div
            onClick={onClick}
            className="rounded-[32px] p-6 relative group cursor-pointer hover:shadow-md transition-shadow"
            style={{ backgroundColor: s.bg }}
        >
            <div className="flex justify-between items-start mb-4">
                <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-full bg-white/50 flex items-center justify-center">
                        {s.icon}
                    </div>
                    <Badge variant={s.badgeVariant} />
                </div>
                <button className="w-8 h-8 rounded-full bg-white/30 flex items-center justify-center group-hover:bg-white/60 transition-colors">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke={s.textMid} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <line x1="7" y1="17" x2="17" y2="7" /><polyline points="7 7 17 7 17 17" />
                    </svg>
                </button>
            </div>

            <h4 className="text-xl font-bold mb-2" style={{ color: s.textDark }}>{title}</h4>
            <p className="text-sm leading-relaxed mb-6 w-5/6" style={{ color: s.textMid }}>{description}</p>

            <div className="flex items-center gap-2">
                <div className="flex-1 h-2 rounded-full overflow-hidden" style={{ backgroundColor: s.progressBg }}>
                    <div className="h-full rounded-full" style={{ backgroundColor: s.progressFill, width: `${score}%` }} />
                </div>
                <span className="text-sm font-bold" style={{ color: s.textDark }}>
                    {score}<span className="font-normal" style={{ color: s.textMid }}>/100</span>
                </span>
            </div>
        </div>
    );
};

export { colorSchemes };
