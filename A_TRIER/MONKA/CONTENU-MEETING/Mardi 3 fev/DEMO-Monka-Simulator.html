<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Monka Simulator ‚Äì Vuln√©rabilit√© Sociale & Relationnelle</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Monka brand colors */
            --mint: #5DDEBE;
            --mint-soft: #E8FBF5;
            --peach: #F5B895;
            --peach-soft: #FFF5EE;
            --light-blue: #E2F2FC;
            --bg: #FAF9F7;
            --white: #FFFFFF;
            --black: #0A0A0A;
            --text: #1A1A1A;
            --text-2: #3B3B3B;
            --text-3: #6B6B6B;
            --border: #E5E5E5;
            --red: #E85A5A;
            --red-soft: #FEF2F2;
            --orange: #F59E0B;
            --orange-soft: #FFF7ED;
            --green: #22C55E;
            --green-soft: #F0FDF4;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
            font-size: 14px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 24px 32px;
            background: var(--white);
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }

        .logo-circle {
            width: 48px;
            height: 48px;
            background: var(--black);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 24px;
        }

        .header-content {
            text-align: left;
        }

        header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            letter-spacing: -0.5px;
        }

        header p {
            color: var(--text-3);
            font-size: 0.9rem;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: var(--white);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }

        .panel-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
            color: var(--text);
        }

        .panel-title .icon {
            font-size: 1.25rem;
        }

        /* Questionnaire */
        .question-card {
            background: var(--bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .question-card:hover {
            border-color: var(--mint);
            box-shadow: var(--shadow-sm);
        }

        .question-card.critical {
            border-left: 4px solid var(--red);
        }

        .question-card.scoring {
            border-left: 4px solid var(--mint);
        }

        .question-card.trigger {
            border-left: 4px solid var(--orange);
        }

        .question-id {
            display: inline-block;
            font-size: 11px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 100px;
            margin-bottom: 8px;
        }

        .question-id.critical {
            background: var(--red-soft);
            color: var(--red);
        }

        .question-id.scoring {
            background: var(--mint-soft);
            color: #0D9488;
        }

        .question-id.trigger {
            background: var(--orange-soft);
            color: #B45309;
        }

        .question-label {
            font-weight: 500;
            margin-bottom: 12px;
            font-size: 13px;
            color: var(--text);
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--white);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid var(--border);
            font-size: 13px;
        }

        .option:hover {
            border-color: var(--mint);
            background: var(--mint-soft);
        }

        .option.selected {
            background: var(--mint-soft);
            border-color: var(--mint);
        }

        .option.critical-selected {
            background: var(--red-soft);
            border-color: var(--red);
        }

        .option input {
            display: none;
        }

        .option .radio {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 2px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .option.selected .radio {
            border-color: var(--mint);
            background: var(--mint);
        }

        .option.critical-selected .radio {
            border-color: var(--red);
            background: var(--red);
        }

        .option .radio::after {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: white;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .option.selected .radio::after,
        .option.critical-selected .radio::after {
            opacity: 1;
        }

        .option-score {
            margin-left: auto;
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 6px;
            background: var(--bg);
            color: var(--text-3);
            font-weight: 500;
        }

        /* Results Panel */
        .result-section {
            margin-bottom: 20px;
        }

        .result-section h4 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-3);
            margin-bottom: 12px;
            font-weight: 600;
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: var(--peach);
            border-radius: 12px;
        }

        .score-circle {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 800;
            background: rgba(255, 255, 255, 0.4);
            color: #3D1F00;
            transition: all 0.3s ease;
        }

        .score-circle.green {
            background: var(--green-soft);
            color: var(--green);
        }

        .score-circle.orange {
            background: var(--orange-soft);
            color: var(--orange);
        }

        .score-circle.red {
            background: var(--red-soft);
            color: var(--red);
        }

        .score-details {
            flex: 1;
        }

        .score-label {
            font-size: 13px;
            color: #3D1F00;
            opacity: 0.8;
        }

        .score-interpretation {
            font-weight: 600;
            margin-top: 4px;
            font-size: 14px;
            color: #3D1F00;
        }

        .priority-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 13px;
        }

        .priority-badge.level-1 {
            background: var(--red-soft);
            color: var(--red);
            border: 1px solid #FECACA;
        }

        .priority-badge.level-2 {
            background: var(--orange-soft);
            color: #B45309;
            border: 1px solid #FED7AA;
        }

        .priority-badge.level-3 {
            background: var(--green-soft);
            color: var(--green);
            border: 1px solid #BBF7D0;
        }

        .micro-parcours-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .micro-parcours {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg);
            border-radius: 10px;
            border-left: 3px solid var(--mint);
            font-size: 13px;
        }

        .micro-parcours.activated {
            border-left-color: var(--green);
            background: var(--green-soft);
        }

        .mp-code {
            font-weight: 600;
            font-size: 12px;
            color: var(--text-2);
        }

        .ccc-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .ccc-item {
            padding: 12px 16px;
            background: var(--bg);
            border-radius: 10px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .ccc-item.activated {
            background: var(--red-soft);
            border-left: 3px solid var(--red);
        }

        .ccc-status {
            font-size: 1.25rem;
        }

        /* Recommendations Panel */
        .reco-card {
            background: var(--bg);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 3px solid var(--mint);
        }

        .reco-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .reco-question-id {
            font-weight: 600;
            font-size: 12px;
            color: #0D9488;
        }

        .reco-actor {
            margin-left: auto;
            font-size: 11px;
            padding: 4px 10px;
            background: var(--mint-soft);
            border-radius: 100px;
            color: #0D9488;
            font-weight: 500;
        }

        .reco-text {
            font-size: 13px;
            margin-bottom: 12px;
            color: var(--text);
        }

        .micro-tasks {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .micro-task {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            font-size: 12px;
            color: var(--text-3);
        }

        .micro-task::before {
            content: '‚Üí';
            color: var(--green);
        }

        .empty-state {
            text-align: center;
            padding: 32px;
            color: var(--text-3);
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 13px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 16px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-2);
        }

        .tab:hover {
            border-color: var(--mint);
            background: var(--mint-soft);
        }

        .tab.active {
            background: var(--black);
            border-color: var(--black);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Action buttons */
        .actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--black);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .btn-outline {
            background: var(--white);
            border: 1px solid var(--border);
            color: var(--text);
        }

        .btn-outline:hover {
            border-color: var(--text-3);
            background: var(--bg);
        }

        /* Scrollable panels */
        .scrollable {
            max-height: 70vh;
            overflow-y: auto;
        }

        .scrollable::-webkit-scrollbar {
            width: 6px;
        }

        .scrollable::-webkit-scrollbar-track {
            background: var(--bg);
            border-radius: 3px;
        }

        .scrollable::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .scrollable::-webkit-scrollbar-thumb:hover {
            background: var(--text-3);
        }

        /* AI Badge */
        .ai-badge {
            background: linear-gradient(135deg, #E0E7FF 0%, #F3E8FF 100%);
            color: #6366F1;
            padding: 4px 10px;
            border-radius: 100px;
            font-size: 11px;
            font-weight: 700;
            border: 1px solid #C7D2FE;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: auto;
        }

        /* Animation */
        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="logo-circle">M</div>
            <div class="header-content">
                <h1>Monka Simulator</h1>
                <p>Test interactif ‚Äì Vuln√©rabilit√© "Sociale & Relationnelle"</p>
            </div>
            <span class="ai-badge">‚ú® Moteur IA</span>
        </header>

        <div class="grid">
            <!-- LEFT: Questionnaire -->
            <div class="panel">
                <div class="panel-title">
                    <span class="icon">üìã</span>
                    <span>Questionnaire Aidant</span>
                </div>
                <div class="scrollable" id="questionnaire">
                    <!-- Questions will be injected here -->
                </div>
                <div class="actions">
                    <button class="btn btn-primary" onclick="resetAll()">üîÑ R√©initialiser</button>
                </div>
            </div>

            <!-- RIGHT: Results -->
            <div class="panel">
                <div class="panel-title">
                    <span class="icon">‚öôÔ∏è</span>
                    <span>Moteur Monka (Vue interne)</span>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="switchTab('scoring')">üìä Scoring</div>
                    <div class="tab" onclick="switchTab('engine')">üîß Moteur</div>
                    <div class="tab" onclick="switchTab('recos')">üí° Recommandations</div>
                </div>

                <div class="scrollable">
                    <!-- Scoring Tab -->
                    <div class="tab-content active" id="tab-scoring">
                        <div class="result-section">
                            <h4>Score Vuln√©rabilit√©</h4>
                            <div class="score-display">
                                <div class="score-circle green" id="score-circle">
                                    <span id="score-value">0</span>
                                </div>
                                <div class="score-details">
                                    <div class="score-label">Score brut: <span id="score-raw">0</span>/16</div>
                                    <div class="score-interpretation" id="score-interpretation">Situation sociale
                                        globalement pr√©serv√©e</div>
                                </div>
                            </div>
                        </div>

                        <div class="result-section">
                            <h4>Priorit√© calcul√©e</h4>
                            <div id="priority-display">
                                <div class="priority-badge level-3">
                                    <span>‚è±Ô∏è</span>
                                    <span>Niveau 3 ‚Äì Planifi√© (>1 mois)</span>
                                </div>
                            </div>
                        </div>

                        <div class="result-section">
                            <h4>D√©tail scoring par question</h4>
                            <div id="scoring-details">
                                <!-- Injected -->
                            </div>
                        </div>
                    </div>

                    <!-- Engine Tab -->
                    <div class="tab-content" id="tab-engine">
                        <div class="result-section">
                            <h4>Questions Critiques Directes</h4>
                            <div id="critical-list">
                                <div class="empty-state">
                                    <div class="icon">‚úÖ</div>
                                    <p>Aucune alerte critique</p>
                                </div>
                            </div>
                        </div>

                        <div class="result-section">
                            <h4>Conditions Critiques Composites (CCC)</h4>
                            <div class="ccc-list" id="ccc-list">
                                <!-- Injected -->
                            </div>
                        </div>

                        <div class="result-section">
                            <h4>Micro-parcours activ√©s</h4>
                            <div class="micro-parcours-list" id="mp-list">
                                <!-- Injected -->
                            </div>
                        </div>
                    </div>

                    <!-- Recommendations Tab -->
                    <div class="tab-content" id="tab-recos">
                        <div id="reco-list">
                            <div class="empty-state">
                                <div class="icon">üí°</div>
                                <p>R√©pondez aux questions pour voir les recommandations</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data
        const questions = [
            {
                id: 'E1',
                label: 'Comment d√©cririez-vous la r√©partition de l\'aide au sein de votre entourage ?',
                type: 'scoring',
                options: [
                    { text: 'R√©partition √©quilibr√©e et satisfaisante', score: 0, critical: false },
                    { text: 'Je fais la plus grande partie mais c\'est acceptable', score: 1, critical: false },
                    { text: 'Je fais presque tout / je suis totalement seul¬∑e', score: 2, critical: false }
                ],
                recommendations: {
                    1: { reco: 'Proposer un temps d\'√©change pour identifier des relais potentiels', actor: 'IDEC', tasks: ['Lister les personnes mobilisables', 'Explorer les freins √† une meilleure r√©partition'] },
                    2: { reco: 'Identifier et mobiliser des ressources d\'aide compl√©mentaires', actor: 'IDEC / Assistante sociale', tasks: ['√âvaluer les aides disponibles', 'Proposer un accompagnement pour solliciter de l\'aide', 'Orienter vers des groupes d\'entraide'] }
                }
            },
            {
                id: 'E2',
                label: 'En cas de coup dur, avez-vous des personnes sur qui compter pour vous aider ?',
                type: 'critical',
                options: [
                    { text: 'Oui, plusieurs personnes', score: 0, critical: false },
                    { text: 'Oui, une personne', score: 1, critical: false },
                    { text: 'Tr√®s peu de personnes / personne', score: 2, critical: true }
                ],
                recommendations: {
                    1: { reco: 'Renforcer le r√©seau de soutien existant', actor: 'IDEC', tasks: ['Identifier d\'autres personnes mobilisables', 'Informer sur les solutions de r√©pit'] },
                    2: { reco: 'Mettre en place un accompagnement renforc√© et identifier des solutions de soutien', actor: 'IDEC / Assistante sociale', tasks: ['√âvaluer l\'urgence de l\'isolement', 'Proposer un contact r√©gulier avec un professionnel', 'Orienter vers des dispositifs d\'aide aux aidants', 'Envisager un accueil temporaire'] }
                }
            },
            {
                id: 'E4',
                label: 'Comment a √©volu√© votre relation avec votre proche depuis que vous l\'aidez ?',
                type: 'scoring',
                options: [
                    { text: 'Relation renforc√©e ou globalement similaire', score: 0, critical: false },
                    { text: 'Relation plus tendue / plus compliqu√©e', score: 1, critical: false }
                ],
                recommendations: {
                    1: { reco: 'Proposer un espace d\'√©coute pour aborder les difficult√©s relationnelles', actor: 'IDEC / Psychologue', tasks: ['√âchanger sur les sources de tension', 'Proposer un accompagnement psychologique', 'Informer sur les groupes de parole'] }
                }
            },
            {
                id: 'E5',
                label: 'Existe-t-il des tensions ou des d√©saccords au sein de la famille concernant la prise en charge de votre proche ?',
                type: 'scoring',
                options: [
                    { text: 'Non', score: 0, critical: false },
                    { text: 'Parfois', score: 1, critical: false },
                    { text: 'Oui', score: 2, critical: false }
                ],
                recommendations: {
                    1: { reco: '√âchanger sur les sources de d√©saccord', actor: 'IDEC', tasks: ['Identifier les points de tension r√©currents'] },
                    2: { reco: 'Se rapprocher du r√©f√©rent, envisager une m√©diation familiale', actor: 'IDEC / M√©decin / M√©diateur', tasks: ['Proposer un entretien de m√©diation', 'Orienter vers des dispositifs de m√©diation'] }
                }
            },
            {
                id: 'E6',
                label: 'Votre proche accepte-t-il l\'aide de personnes ext√©rieures (aide √† domicile, infirmier, structure, etc.) ?',
                type: 'critical',
                options: [
                    { text: 'Oui, facilement', score: 0, critical: false },
                    { text: 'Oui, mais avec des r√©ticences', score: 0, critical: false },
                    { text: 'Non, refuse la plupart du temps', score: 0, critical: true },
                    { text: 'Je ne sais pas / pas encore essay√©', score: 0, critical: false }
                ],
                recommendations: {
                    1: { reco: '√âchanger sur les r√©ticences exprim√©es', actor: 'IDEC', tasks: ['Comprendre les freins √† l\'acceptation'] },
                    2: { reco: 'Accompagnement renforc√© pour lever les blocages', actor: 'IDEC / M√©decin', tasks: ['Proposer un √©change avec le proche', 'Explorer les causes du refus', 'Proposer une approche progressive'] },
                    3: { reco: 'Informer sur les types d\'aides existantes', actor: 'IDEC', tasks: ['Proposer une premi√®re mise en relation'] }
                }
            },
            {
                id: 'N4',
                label: '√ätes-vous le seul membre de la famille √† vous occuper de votre proche ?',
                type: 'trigger',
                options: [
                    { text: 'Non', score: 0, critical: false, trigger: null },
                    { text: 'Oui', score: 0, critical: false, trigger: 'R2' }
                ],
                recommendations: {
                    1: { reco: 'Identifier des relais possibles et s√©curiser l\'aidant principal', actor: 'IDEC', tasks: ['√âvaluer les possibilit√©s de mobilisation', 'Proposer des solutions de r√©pit', 'Orienter vers des associations'] }
                }
            },
            {
                id: 'N20',
                label: 'Votre proche a-t-il des difficult√©s √† maintenir des relations sociales ?',
                type: 'scoring',
                options: [
                    { text: 'Non', score: 0, critical: false },
                    { text: 'Parfois', score: 1, critical: false },
                    { text: 'Oui', score: 2, critical: false }
                ],
                recommendations: {
                    1: { reco: 'Surveiller l\'√©volution', actor: 'IDEC', tasks: ['Identifier les situations probl√©matiques'] },
                    2: { reco: '√âvaluer les besoins de stimulation sociale', actor: 'IDEC / Ergoth√©rapeute', tasks: ['Proposer des activit√©s adapt√©es', '√âvaluer l\'int√©r√™t d\'un accueil de jour'] }
                }
            },
            {
                id: 'O27',
                label: 'La situation de votre proche a-t-elle des r√©percussions sur votre vie familiale ?',
                type: 'scoring',
                options: [
                    { text: 'Pas du tout', score: 0, critical: false },
                    { text: 'Un peu', score: 1, critical: false },
                    { text: 'Oui', score: 2, critical: false }
                ],
                recommendations: {
                    1: { reco: 'Surveiller l\'√©volution et proposer un √©change si besoin', actor: 'IDEC', tasks: ['Rester attentif aux signaux de d√©gradation'] },
                    2: { reco: 'Mettre en place un accompagnement pour pr√©server l\'√©quilibre familial', actor: 'IDEC / Psychologue', tasks: ['Identifier les domaines impact√©s', 'Proposer un soutien psychologique', 'Orienter vers des solutions de r√©pit'] }
                }
            },
            {
                id: 'O28',
                label: 'La situation de votre proche a-t-elle des r√©percussions sur votre vie sociale, vos loisirs ou votre travail ?',
                type: 'scoring',
                options: [
                    { text: 'Pas du tout', score: 0, critical: false },
                    { text: 'Un peu', score: 1, critical: false },
                    { text: 'Oui', score: 2, critical: false }
                ],
                recommendations: {
                    1: { reco: 'Surveiller et proposer un √©change', actor: 'IDEC', tasks: ['Identifier les activit√©s impact√©es'] },
                    2: { reco: 'Mettre en place un accompagnement renforc√©', actor: 'IDEC / Assistante sociale', tasks: ['√âvaluer l\'impact professionnel', 'Informer sur les droits des aidants', 'Proposer des solutions d\'am√©nagement'] }
                }
            },
            {
                id: 'O30',
                label: 'Avez-vous le sentiment de ne plus reconna√Ætre votre proche ?',
                type: 'scoring',
                options: [
                    { text: 'Pas du tout', score: 0, critical: false },
                    { text: 'Un peu', score: 1, critical: false },
                    { text: 'Oui', score: 2, critical: false }
                ],
                recommendations: {
                    1: { reco: 'Proposer un espace d\'√©coute', actor: 'IDEC', tasks: ['√âchanger sur les changements observ√©s'] },
                    2: { reco: 'Accompagnement psychologique recommand√©', actor: 'IDEC / Psychologue', tasks: ['Proposer un soutien psychologique', 'Informer sur la maladie', 'Orienter vers des groupes de parole'] }
                }
            }
        ];

        const cccRules = [
            { code: 'R1_CC_01', questions: ['O27', 'O28'], logic: 'O27=2 ET O28=2', mp: 'R1', label: 'Retentissement vie priv√©e + sociale' },
            { code: 'R2_CC_01', questions: ['N4', 'E2'], logic: 'N4=1 ET E2=2', mp: 'R2', label: 'Aidant seul sans soutien' },
            { code: 'R2_CC_02', questions: ['E1', 'E2'], logic: 'E1=2 ET E2=2', mp: 'R2', label: 'Charge exclusive sans filet' },
            { code: 'R3_CC_01', questions: ['N20', 'O48'], logic: 'N20=2 ET O48‚â§1', mp: 'R3', label: 'Isolement social du proche' },
            { code: 'R4_CC_01', questions: ['O30', 'E4'], logic: 'O30=2 ET E4=1', mp: 'R4', label: 'D√©gradation du lien' },
            { code: 'R4_CC_02', questions: ['E5', 'E1'], logic: 'E5=2 ET E1=2', mp: 'R4', label: 'Conflits + charge d√©s√©quilibr√©e' }
        ];

        const microParcours = [
            { code: 'R1', name: 'Impact vie personnelle / sociale / pro' },
            { code: 'R2', name: 'Soutien de l\'entourage' },
            { code: 'R3', name: 'Isolement social du proche' },
            { code: 'R4', name: 'Relation aidant/aid√© & dynamique familiale' }
        ];

        let answers = {};

        // Initialize
        function init() {
            renderQuestions();
            renderCCC();
            renderMicroParcours();
            updateResults();
        }

        function renderQuestions() {
            const container = document.getElementById('questionnaire');
            container.innerHTML = questions.map((q, idx) => `
                <div class="question-card ${q.type}">
                    <span class="question-id ${q.type}">${q.id} ‚Äì ${q.type === 'critical' ? '‚ö†Ô∏è Critique' : q.type === 'scoring' ? 'üìä Scorante' : 'üîÄ Trigger'}</span>
                    <div class="question-label">${q.label}</div>
                    <div class="options">
                        ${q.options.map((opt, optIdx) => `
                            <label class="option" id="opt-${q.id}-${optIdx}" onclick="selectOption('${q.id}', ${optIdx})">
                                <div class="radio"></div>
                                <span>${opt.text}</span>
                                ${opt.score > 0 ? `<span class="option-score">+${opt.score}</span>` : ''}
                                ${opt.critical ? '<span class="option-score" style="background: rgba(239,68,68,0.2); color: #ef4444;">üî¥ Critique</span>' : ''}
                            </label>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function selectOption(questionId, optionIndex) {
            const question = questions.find(q => q.id === questionId);
            const option = question.options[optionIndex];

            answers[questionId] = { optionIndex, score: option.score, critical: option.critical, trigger: option.trigger };

            // Update UI
            question.options.forEach((_, idx) => {
                const el = document.getElementById(`opt-${questionId}-${idx}`);
                el.classList.remove('selected', 'critical-selected');
            });

            const selectedEl = document.getElementById(`opt-${questionId}-${optionIndex}`);
            selectedEl.classList.add(option.critical ? 'critical-selected' : 'selected');

            updateResults();
        }

        function updateResults() {
            // Calculate score
            let rawScore = 0;
            const scoringQuestions = ['E1', 'E2', 'E4', 'E5', 'N20', 'O27', 'O28', 'O30'];
            scoringQuestions.forEach(qId => {
                if (answers[qId]) {
                    rawScore += answers[qId].score;
                }
            });

            const normalizedScore = Math.round((rawScore / 16) * 20 * 10) / 10;

            // Update score display
            document.getElementById('score-raw').textContent = rawScore;
            document.getElementById('score-value').textContent = normalizedScore;

            const circle = document.getElementById('score-circle');
            circle.classList.remove('green', 'orange', 'red');

            let interpretation = '';
            if (normalizedScore <= 6) {
                circle.classList.add('green');
                interpretation = 'üü¢ Situation sociale globalement pr√©serv√©e';
            } else if (normalizedScore <= 13) {
                circle.classList.add('orange');
                interpretation = 'üü† Fragilisation sociale et relationnelle';
            } else {
                circle.classList.add('red');
                interpretation = 'üî¥ Isolement ou rupture relationnelle probable';
            }
            document.getElementById('score-interpretation').textContent = interpretation;

            // Check critical direct
            let hasCritical = false;
            let criticalMessages = [];
            Object.entries(answers).forEach(([qId, ans]) => {
                if (ans.critical) {
                    hasCritical = true;
                    const q = questions.find(q => q.id === qId);
                    criticalMessages.push(`${qId}: ${q.options[ans.optionIndex].text}`);
                }
            });

            // Check CCC
            let activatedCCC = [];
            cccRules.forEach(ccc => {
                let activated = false;
                if (ccc.code === 'R1_CC_01' && answers['O27']?.score === 2 && answers['O28']?.score === 2) activated = true;
                if (ccc.code === 'R2_CC_01' && answers['N4']?.optionIndex === 1 && answers['E2']?.score === 2) activated = true;
                if (ccc.code === 'R2_CC_02' && answers['E1']?.score === 2 && answers['E2']?.score === 2) activated = true;
                if (ccc.code === 'R4_CC_01' && answers['O30']?.score === 2 && answers['E4']?.score === 1) activated = true;
                if (ccc.code === 'R4_CC_02' && answers['E5']?.score === 2 && answers['E1']?.score === 2) activated = true;

                if (activated) activatedCCC.push(ccc);
            });

            // Determine priority
            let priority = 3;
            let priorityLabel = 'Niveau 3 ‚Äì Planifi√© (>1 mois)';
            let priorityClass = 'level-3';
            let priorityIcon = '‚è±Ô∏è';

            if (hasCritical) {
                priority = 1;
                priorityLabel = 'Niveau 1 ‚Äì URGENT (‚â§ 7 jours)';
                priorityClass = 'level-1';
                priorityIcon = 'üö®';
            } else if (activatedCCC.length > 0) {
                priority = 2;
                priorityLabel = 'Niveau 2 ‚Äì Prioritaire (‚â§ 7 jours)';
                priorityClass = 'level-2';
                priorityIcon = '‚ö°';
            }

            document.getElementById('priority-display').innerHTML = `
                <div class="priority-badge ${priorityClass}">
                    <span>${priorityIcon}</span>
                    <span>${priorityLabel}</span>
                </div>
            `;

            // Critical list
            if (hasCritical) {
                document.getElementById('critical-list').innerHTML = criticalMessages.map(msg => `
                    <div class="ccc-item activated">
                        <span class="ccc-status">üö®</span>
                        <span>${msg}</span>
                    </div>
                `).join('');
            } else {
                document.getElementById('critical-list').innerHTML = `
                    <div class="empty-state">
                        <div class="icon">‚úÖ</div>
                        <p>Aucune alerte critique</p>
                    </div>
                `;
            }

            // Update CCC display
            document.querySelectorAll('.ccc-item').forEach(el => el.classList.remove('activated'));
            activatedCCC.forEach(ccc => {
                const el = document.getElementById(`ccc-${ccc.code}`);
                if (el) el.classList.add('activated');
            });

            // Update micro-parcours
            let activatedMP = new Set();
            if (hasCritical) {
                if (answers['E2']?.critical) activatedMP.add('R2');
                if (answers['E6']?.critical) activatedMP.add('R4');
            }
            activatedCCC.forEach(ccc => activatedMP.add(ccc.mp));
            Object.entries(answers).forEach(([qId, ans]) => {
                if (ans.trigger) activatedMP.add(ans.trigger);
            });

            document.querySelectorAll('.micro-parcours').forEach(el => el.classList.remove('activated'));
            activatedMP.forEach(mp => {
                const el = document.getElementById(`mp-${mp}`);
                if (el) el.classList.add('activated');
            });

            // Update recommendations
            updateRecommendations();

            // Update scoring details
            updateScoringDetails(scoringQuestions);
        }

        function updateScoringDetails(scoringQuestions) {
            const container = document.getElementById('scoring-details');
            container.innerHTML = scoringQuestions.map(qId => {
                const q = questions.find(q => q.id === qId);
                const ans = answers[qId];
                const score = ans ? ans.score : '-';
                const maxScore = qId === 'E4' ? 1 : 2;
                return `
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg); border-radius: 0.25rem; margin-bottom: 0.25rem; font-size: 0.875rem;">
                        <span>${qId}</span>
                        <span style="color: ${ans ? 'var(--primary)' : 'var(--text-muted)'};">${score} / ${maxScore}</span>
                    </div>
                `;
            }).join('');
        }

        function updateRecommendations() {
            const container = document.getElementById('reco-list');
            let recos = [];

            Object.entries(answers).forEach(([qId, ans]) => {
                const q = questions.find(q => q.id === qId);
                if (q.recommendations && q.recommendations[ans.optionIndex]) {
                    const r = q.recommendations[ans.optionIndex];
                    recos.push({ qId, ...r });
                }
            });

            if (recos.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üí°</div>
                        <p>R√©pondez aux questions pour voir les recommandations</p>
                    </div>
                `;
            } else {
                container.innerHTML = recos.map(r => `
                    <div class="reco-card">
                        <div class="reco-header">
                            <span class="reco-question-id">${r.qId}</span>
                            <span class="reco-actor">${r.actor}</span>
                        </div>
                        <div class="reco-text">${r.reco}</div>
                        <div class="micro-tasks">
                            ${r.tasks.map(t => `<div class="micro-task">${t}</div>`).join('')}
                        </div>
                    </div>
                `).join('');
            }
        }

        function renderCCC() {
            const container = document.getElementById('ccc-list');
            container.innerHTML = cccRules.map(ccc => `
                <div class="ccc-item" id="ccc-${ccc.code}">
                    <span class="ccc-status">‚¨ú</span>
                    <span><strong>${ccc.code}</strong>: ${ccc.label}</span>
                </div>
            `).join('');
        }

        function renderMicroParcours() {
            const container = document.getElementById('mp-list');
            container.innerHTML = microParcours.map(mp => `
                <div class="micro-parcours" id="mp-${mp.code}">
                    <span class="mp-code">${mp.code}</span>
                    <span>${mp.name}</span>
                </div>
            `).join('');
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }

        function resetAll() {
            answers = {};
            document.querySelectorAll('.option').forEach(el => {
                el.classList.remove('selected', 'critical-selected');
            });
            updateResults();
        }

        // Start
        init();
    </script>
</body>

</html>